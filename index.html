<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Curr√≠culo Esportivo de Corredores</title>
    
    <!-- SDKs do Firebase (OBRIGAT√ìRIO) -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
    
    <style>
        /* Estiliza√ß√£o Geral (Dark Mode) */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #1f2027 0%, #3a3a52 100%);
            min-height: 100vh;
            padding: 20px;
            color: #f0f0f0;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: rgba(42, 42, 58, 0.85);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
            overflow: hidden;
            border: 1px solid rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(8px);
        }

        .header {
            background: linear-gradient(135deg, #764ba2 0%, #667eea 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }

        .header p {
            font-size: 1.2em;
            opacity: 0.9;
            min-height: 1.2em;
        }

        /* UI de Autentica√ß√£o e Sele√ß√£o de Perfil */
        #auth-container {
            padding: 20px; 
            background: rgba(31, 32, 39, 0.7); 
            text-align: center; 
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .form-container {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            align-items: center;
            gap: 10px;
        }
        
        #auth-container input, #auth-container select {
            padding: 10px 15px;
            border-radius: 8px;
            border: 1px solid #555;
            background: #333345;
            color: #f0f0f0;
            font-size: 0.9em;
        }
        #auth-container input:focus, #auth-container select:focus {
            outline: none;
            border-color: #667eea;
        }

        .btn {
            padding: 10px 18px;
            border: none;
            border-radius: 8px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .btn-primary { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; }
        .btn-primary:hover { box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3); }
        .btn-secondary { background: #6c757d; color: white; }
        .btn-secondary:hover { background: #5a6268; }
        
        #user-info { display: none; align-items: center; justify-content: center; gap: 20px; }
        #user-email { font-size: 1.1em; color: #fff; }
        #btn-logout { background: #dc3545; }
        #public-profile-selector { display: none; }
        #public-profile-selector label { margin-right: 10px; font-weight: 600; }
        
        /* Painel do Administrador */
        #admin-panel {
            display: none;
            padding: 20px;
            background: rgba(126, 75, 162, 0.2);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        #admin-panel h2 { text-align: center; margin-bottom: 15px; color: #f06292; }
        .pending-user {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: #2a2a3a;
            padding: 10px;
            border-radius: 8px;
            margin-bottom: 10px;
        }
        .pending-user .btn { padding: 5px 10px; font-size: 0.9em; }

        /* Dashboard de Performance */
        .dashboard-section { padding: 30px; background: rgba(20, 20, 30, 0.5); }
        .dashboard-header { text-align: center; margin-bottom: 20px; font-size: 1.8em; color: #c5cae9; }
        .dashboard-subheader { text-align: center; margin-bottom: 15px; color: #aaa; font-weight: 600; }
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 20px; margin-bottom: 20px; }
        .stat-card { background: #2a2a3a; padding: 20px; border-radius: 15px; text-align: center; box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2); transition: all 0.3s ease; border: 1px solid rgba(255, 255, 255, 0.05); }
        .stat-card:hover { transform: translateY(-5px); box-shadow: 0 15px 30px rgba(0, 0, 0, 0.3); }
        .stat-number { font-size: 2em; font-weight: bold; color: #c5cae9; margin-bottom: 8px; line-height: 1.2; }
        .stat-label { color: #b0b0b0; font-weight: 600; font-size: 0.9em; }
        .pr-card .stat-number { font-size: 1.4em; }
        .pr-card .runner-pr { font-size: 0.9em; color: #f0f0f0; line-height: 1.5; }
        .pr-card .runner-pr-1 { color: #4dabf5; font-weight: 600; }
        .pr-card .runner-pr-2 { color: #f06292; font-weight: 600; }
        
        /* Controles e Hist√≥rico */
        .controls-section { padding: 20px 30px; text-align: center; background: #1a1a2e; }
        .btn-add { padding: 15px 30px; background: linear-gradient(135deg, #28a745 0%, #218838 100%); color: white; border: none; border-radius: 10px; font-size: 1.1em; font-weight: 600; cursor: pointer; transition: all 0.3s ease; }
        .btn-add:hover { transform: translateY(-2px); box-shadow: 0 10px 20px rgba(40, 167, 69, 0.3); }
        .btn-add:disabled { background: #6c757d; opacity: 0.5; cursor: not-allowed; box-shadow: none; transform: none; }

        .history-section { padding: 30px; background: transparent; }
        .year-group { margin-bottom: 30px; }
        .year-title { font-size: 2em; color: #c5cae9; border-bottom: 3px solid #c5cae9; padding-bottom: 10px; margin-bottom: 20px; }
        .race-card-list { display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: 20px; }
        .race-card { background: #2a2a3a; border-radius: 15px; box-shadow: 0 10px 20px rgba(0, 0, 0, 0.3); overflow: hidden; display: flex; flex-direction: column; border: 1px solid rgba(255, 255, 255, 0.05); }
        .race-card.status-planned { background: #3a382a; border: 2px dashed #ffc107; }
        .race-card.status-skipped { background: #3a2a2a; opacity: 0.7; }
        .race-card-header { padding: 20px; border-bottom: 1px solid #444; }
        .race-card-header h3 { font-size: 1.3em; color: #ffffff; margin-bottom: 5px; }
        .race-card-header .date { font-size: 0.9em; color: #b0b0b0; font-weight: 600; }
        .race-card-body { padding: 20px; flex-grow: 1; }
        .runner-info { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 15px; padding-bottom: 15px; border-bottom: 1px dashed #444; }
        .runner-info:last-child { margin-bottom: 0; padding-bottom: 0; border-bottom: 0; }
        .runner-info .runner-name { font-weight: bold; font-size: 1.1em; }
        .runner-info .runner-name.runner1 { color: #4dabf5; }
        .runner-info .runner-name.runner2 { color: #f06292; }
        .runner-details { text-align: right; }
        .runner-time { font-size: 1.2em; font-weight: 700; color: #4caf50; }
        .runner-time.goal { color: #ffc107; font-size: 1.1em; }
        .runner-time.skipped { color: #f44336; font-size: 1.1em; font-style: italic; }
        .runner-pace { font-size: 0.9em; color: #b0b0b0; font-family: monospace; }
        .runner-pace.goal { color: #ffeb3b; }
        .race-card-footer { padding: 10px 20px; background: #222230; display: flex; justify-content: space-between; align-items: center; }
        .juntos-icon { font-size: 1.5em; }
        .race-notes { font-size: 0.85em; color: #b0b0b0; font-style: italic; margin-left: 10px; }
        .race-distance { font-size: 1.1em; font-weight: bold; color: #c5cae9; margin-right: 15px; }
        .race-controls { display: flex; gap: 10px; }
        .race-controls.hidden { display: none; }
        .btn-control { background: none; border: none; cursor: pointer; font-size: 1em; color: #b0b0b0; opacity: 0.6; transition: opacity 0.3s; }
        .btn-control:hover { opacity: 1; }

        /* Modal e Formul√°rio */
        dialog { border: 1px solid rgba(255, 255, 255, 0.2); border-radius: 15px; box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2); width: 90%; max-width: 600px; padding: 0; overflow: hidden; background: #2a2a3a; color: #f0f0f0; }
        dialog::backdrop { background: rgba(0, 0, 0, 0.6); backdrop-filter: blur(5px); }
        .modal-header { padding: 20px 30px; background: #1f2027; border-bottom: 1px solid #444; display: flex; justify-content: space-between; align-items: center; }
        .modal-header h2 { color: #c5cae9; }
        .modal-body { padding: 30px; display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        .form-group { display: flex; flex-direction: column; }
        .form-group.full-width { grid-column: 1 / -1; }
        .form-group label { font-weight: 600; color: #b0b0b0; font-size: 0.9em; margin-bottom: 8px; }
        .form-group input, .form-group select { padding: 12px 15px; border: 2px solid #555; border-radius: 10px; font-size: 1em; transition: all 0.3s ease; background: #333345; color: #f0f0f0; }
        .form-group input:focus, .form-group select:focus { outline: none; border-color: #667eea; box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.2); }
        .form-group.checkbox { grid-column: 1 / -1; flex-direction: row; align-items: center; gap: 10px; font-size: 1.1em; }
        .form-group.checkbox input { width: 20px; height: 20px; }
        .runner-form-group { border: 2px solid #555; border-radius: 10px; padding: 15px; }
        .runner-form-group h4 { font-size: 1.2em; margin-bottom: 15px; text-align: center; }
        .runner-form-group.runner1 h4 { color: #4dabf5; }
        .runner-form-group.runner2 h4 { color: #f06292; }
        .modal-footer { padding: 20px 30px; background: #1f2027; border-top: 1px solid #444; display: flex; justify-content: flex-end; gap: 15px; }
        #btn-delete { background: #dc3545; color: white; margin-right: auto; }
        #btn-delete:hover { background: #c82333; }
        #btn-delete.hidden { display: none; }
        .footer { background: #343a40; color: white; text-align: center; padding: 20px; font-size: 0.9em; }

        /* Loading/Empty State */
        #loading-state { text-align: center; padding: 50px; font-size: 1.2em; color: #b0b0b0; }
        #loading-state.hidden { display: none; }

        /* Responsividade */
        @media (max-width: 768px) {
            body { padding: 10px; }
            .header h1 { font-size: 2em; }
            .form-container { flex-direction: column; gap: 15px; }
            .form-container input, .form-container select { width: 100%; }
            .form-container .btn { width: 100%; }
            .stats-grid { grid-template-columns: 1fr 1fr; }
            .race-card-list { grid-template-columns: 1fr; }
            .modal-body { grid-template-columns: 1fr; }
            .form-group.checkbox { font-size: 1em; }
        }
    </style>
</head>
<body>

    <div class="container">
        <div class="header">
            <h1>Curr√≠culo Esportivo üèÉ‚Äç‚ôÇÔ∏èüèÉ‚Äç‚ôÄÔ∏è</h1>
            <p id="header-subtitle">Carregando perfil...</p>
        </div>
        
        <!-- UI de Autentica√ß√£o e Sele√ß√£o de Perfil -->
        <div id="auth-container">
            <div id="public-profile-selector" class="form-container">
                <label for="profile-select">Visualizar Perfil P√∫blico:</label>
                <select id="profile-select" class="btn-secondary"></select>
            </div>
            <form id="login-form" class="form-container">
                <input type="email" id="login-email" placeholder="E-mail" required>
                <input type="password" id="login-pass" placeholder="Senha" required>
                <button type="submit" class="btn btn-primary">Login</button>
                <button type="button" id="btn-signup" class="btn btn-secondary">Cadastrar</button>
            </form>
            <div id="user-info" class="form-container">
                <span id="user-email"></span>
                <button type="button" id="btn-logout" class="btn">Logout</button>
            </div>
        </div>

        <!-- Painel do Administrador -->
        <div id="admin-panel">
            <h2>‚öôÔ∏è Painel de Administra√ß√£o - Aprova√ß√µes Pendentes</h2>
            <div id="pending-users-list"></div>
        </div>

        <!-- Dashboard de Performance -->
        <div class="dashboard-section">
            <h2 class="dashboard-header">Dashboard de Performance</h2>
            <h3 class="dashboard-subheader">Recordes Pessoais (PRs)</h3>
            <div class="stats-grid" id="pr-grid"></div>
            <h3 class="dashboard-subheader" style="margin-top: 30px;">Estat√≠sticas Gerais</h3>
            <div class="stats-grid" id="summary-grid"></div>
        </div>

        <!-- Controles -->
        <div class="controls-section">
            <button class="btn-add" id="btn-add-new" disabled>Carregando...</button>
        </div>

        <!-- Hist√≥rico de Corridas -->
        <div class="history-section">
            <div id="history-container">
                <div id="loading-state">Carregando hist√≥rico de corridas...</div>
            </div>
        </div>

        <div class="footer">
            Desenvolvido com ü§ñ por <strong>thIAguinho Solu√ß√µes</strong>
        </div>
    </div>

    <!-- Modal do Formul√°rio -->
    <dialog id="race-modal">
        <form id="race-form">
            <input type="hidden" id="race-id">
            <div class="modal-header">
                <h2 id="modal-title">Adicionar Nova Corrida</h2>
                <button type="button" class="btn-control" id="btn-close-modal" aria-label="Fechar">‚úñÔ∏è</button>
            </div>
            
            <div class="modal-body">
                 <div class="form-group full-width">
                    <label for="raceName">Nome da Corrida</label>
                    <input type="text" id="raceName" required>
                </div>
                <div class="form-group">
                    <label for="raceDate">Data</label>
                    <input type="date" id="raceDate" required>
                </div>
                <div class="form-group">
                    <label for="raceDistance">Dist√¢ncia Principal (km)</label>
                    <input type="number" step="0.1" id="raceDistance" placeholder="Ex: 5 ou 10">
                </div>
                
                <div class="runner-form-group runner1">
                    <h4 id="runner1-form-name">Corredor 1</h4>
                    <div class="form-group">
                        <label for="runner1Status">Status</label>
                        <select id="runner1Status">
                            <option value="completed">Completou ‚úÖ</option>
                            <option value="planned">Planejada ‚è≥</option>
                            <option value="skipped">N√£o Correu ‚ùå</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="runner1Time">Tempo (HH:MM:SS)</label>
                        <input type="text" id="runner1Time" placeholder="00:29:10">
                    </div>
                    <div class="form-group">
                        <label for="runner1Distance">Dist√¢ncia (se diferente)</label>
                        <input type="number" step="0.1" id="runner1Distance" placeholder="Ex: 10">
                    </div>
                </div>
                
                <div class="runner-form-group runner2">
                    <h4 id="runner2-form-name">Corredor 2</h4>
                    <div class="form-group">
                        <label for="runner2Status">Status</label>
                        <select id="runner2Status">
                            <option value="completed">Completou ‚úÖ</option>
                            <option value="planned">Planejada ‚è≥</option>
                            <option value="skipped">N√£o Correu ‚ùå</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="runner2Time">Tempo (HH:MM:SS)</label>
                        <input type="text" id="runner2Time" placeholder="00:40:36">
                    </div>
                    <div class="form-group">
                        <label for="runner2Distance">Dist√¢ncia (se diferente)</label>
                        <input type="number" step="0.1" id="runner2Distance" placeholder="Ex: 5">
                    </div>
                </div>
                
                <div class="form-group checkbox">
                    <input type="checkbox" id="raceJuntos">
                    <label for="raceJuntos">Correram Juntos? üë©üèª‚Äç‚ù§Ô∏è‚Äçüë®üèª</label>
                </div>
                
                <div class="form-group full-width">
                    <label for="raceNotes">Notas</label>
                    <input type="text" id="raceNotes" placeholder="Ex: ‚ôø Pernas Solid√°rias, meta...">
                </div>
            </div>
            
            <div class="modal-footer">
                <button type="button" class="btn" id="btn-delete" class="hidden">Excluir</button>
                <button type="button" class="btn btn-secondary" id="btn-cancel">Cancelar</button>
                <button type="submit" class="btn btn-primary" id="btn-save">Salvar</button>
            </div>
        </form>
    </dialog>


    <script>
        // =================================================================
        // CONFIGURA√á√ÉO DO FIREBASE (Valores Reais)
        // =================================================================
        
        const firebaseConfig = {
            apiKey: "AIzaSyD4f2an3vC3v17VOwjo23C2PfCwl-PxPc8",
            authDomain: "curriculo-corridas.firebaseapp.com",
            databaseURL: "https://curriculo-corridas-default-rtdb.firebaseio.com",
            projectId: "curriculo-corridas",
            storageBucket: "curriculo-corridas.appspot.com",
            messagingSenderId: "623733303687",
            appId: "1:623733303687:web:68f6c446eebbfec2590b22"
        };
        
        // UID do Administrador (tt@ts.com)
        const ADMIN_UID = "6awggCOZt3P8ARkRytKFuc8v6yz1";
        const PUBLIC_PROFILE_UID_TO_VIEW = ADMIN_UID; // Perfil padr√£o para visitantes √© o do admin

        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.database();
        
        // =================================================================
        // ESTADO GLOBAL DA APLICA√á√ÉO
        // =================================================================
        let localRaces = []; 
        let currentUser = null; 
        let viewingUserID = null; 
        let currentProfile = {};
        let profileRef = null;
        let racesRef = null;
        let pendingUsersRef = null;

        // =================================================================
        // DADOS INICIAIS PARA NOVOS USU√ÅRIOS (HIST√ìRICO COMPLETO)
        // =================================================================
        const initialRaceData = [
             {
                id: '20230820', date: '2023-08-20', year: '2023', raceName: 'Corrida FreshRun - Muffato RP', distance: 5,
                runner1: { status: 'completed', time: '00:29:10' },
                runner2: { status: 'completed', time: '00:40:36' },
                juntos: false, notes: ""
            },
            {
                id: '20240324', date: '2024-03-24', year: '2024', raceName: 'Corrida Instituto Unimed RP', distance: 5,
                runner1: { status: 'completed', time: '00:26:11' },
                runner2: { status: 'completed', time: '00:37:42' },
                juntos: false, notes: ""
            },
            {
                id: '20240519', date: '2024-05-19', year: '2024', raceName: 'Corrida Maio Amarelo RP', distance: null,
                runner1: { status: 'completed', time: '00:42:35', distance: 7 },
                runner2: { status: 'skipped' },
                juntos: false, notes: 'Runner1 correu 7k'
            },
            {
                id: '20240602', date: '2024-06-02', year: '2024', raceName: 'Circuito Sesc de Corridas RP', distance: 5,
                runner1: { status: 'completed', time: '00:39:02' },
                runner2: { status: 'completed', time: '00:39:02' },
                juntos: true, notes: ""
            },
            {
                id: '20240818', date: '2024-08-18', year: '2024', raceName: 'Corrida Muffato RP', distance: null,
                runner1: { status: 'completed', time: '00:55:59', distance: 10 },
                runner2: { status: 'completed', time: '00:39:05', distance: 5 },
                juntos: false, notes: 'Runner1 10k, Runner2 5k'
            },
            {
                id: '20240825', date: '2024-08-25', year: '2024', raceName: 'Circuito Mais Mulher SP / RP', distance: 5,
                runner1: { status: 'skipped' },
                runner2: { status: 'completed', time: '00:39:45' },
                juntos: false, notes: ""
            },
            {
                id: '20240929', date: '2024-09-29', year: '2024', raceName: 'Desafio Extremo Sesc RP', distance: 2,
                runner1: { status: 'completed', time: null },
                runner2: { status: 'skipped' },
                juntos: false, notes: 'Runner1 2k (sem tempo)'
            },
            {
                id: '20241110', date: '2024-11-10', year: '2024', raceName: '5¬™ Corrida 17¬∞ BPM/I RP', distance: null,
                runner1: { status: 'completed', time: '00:55:57', distance: 10 },
                runner2: { status: 'skipped' },
                juntos: false, notes: 'Runner1 10k'
            },
            {
                id: '20241125', date: '2024-11-25', year: '2024', raceName: 'Circuito Corrida de Rua Santander RP', distance: 5,
                runner1: { status: 'completed', time: '00:27:10' },
                runner2: { status: 'completed', time: '00:39:13' },
                juntos: false, notes: ""
            },
            {
                id: '20241201', date: '2024-12-01', year: '2024', raceName: 'ROCK AND RUN RP', distance: 5,
                runner1: { status: 'completed', time: '00:40:05' },
                runner2: { status: 'completed', time: '00:40:05' },
                juntos: true, notes: ""
            },
            {
                id: '20250202', date: '2025-02-02', year: '2025', raceName: 'Corrida Circuito Marilson RP', distance: 5,
                runner1: { status: 'completed', time: '00:26:02' },
                runner2: { status: 'completed', time: '00:36:36' },
                juntos: false, notes: ""
            },
            {
                id: '20250331', date: '2025-03-31', year: '2025', raceName: 'Corrida da Pol√≠cia Federal RP', distance: 5,
                runner1: { status: 'completed', time: '00:38:30' },
                runner2: { status: 'completed', time: '00:37:49' },
                juntos: false, notes: 'Runner1 ‚ôø Pernas Solid√°rias'
            },
            {
                id: '20250413', date: '2025-04-13', year: '2025', raceName: 'Treino Solid√°rio AMICC RP', distance: 5,
                runner1: { status: 'completed', time: '00:38:05' },
                runner2: { status: 'completed', time: '00:38:05' },
                juntos: true, notes: ""
            },
            {
                id: '20250501', date: '2025-05-01', year: '2025', raceName: '46¬™ Corrida Pedestre do Trabalhador Ol√≠mpia - SP', distance: null,
                runner1: { status: 'completed', time: '00:39:42', distance: 7 },
                runner2: { status: 'skipped' },
                juntos: false, notes: 'Runner1 7k'
            },
            {
                id: '20250517', date: '2025-05-17', year: '2025', raceName: 'Corrida Maio Amarelo RP', distance: 5,
                runner1: { status: 'completed', time: '00:27:05' },
                runner2: { status: 'completed', time: '00:38:35' },
                juntos: false, notes: ""
            },
            {
                id: '20250525', date: '2025-05-25', year: '2025', raceName: 'Corrrida Track Field/Santander RP', distance: null,
                runner1: { status: 'completed', time: '00:54:30', distance: 10 },
                runner2: { status: 'completed', time: '00:37:53', distance: 5 },
                juntos: false, notes: 'Runner1 10k, Runner2 5k'
            },
            {
                id: '20250601', date: '2025-06-01', year: '2025', raceName: 'Circuito Sesc de Corridas RP', distance: 5,
                runner1: { status: 'completed', time: '00:36:06' },
                runner2: { status: 'completed', time: '00:36:06' },
                juntos: true, notes: ""
            },
            {
                id: '20250727', date: '2025-07-27', year: '2025', raceName: 'Corrida Circuito Sesc - Catanduva', distance: 6,
                runner1: { status: 'completed', time: '00:49:22' },
                runner2: { status: 'completed', time: '00:49:22' },
                juntos: true, notes: ""
            },
            {
                id: '20250803', date: '2025-08-03', year: '2025', raceName: 'FreshRun - corrida Muffato', distance: null,
                runner1: { status: 'completed', time: '01:07:00', distance: 12 },
                runner2: { status: 'completed', time: '00:46:31', distance: 6 },
                juntos: false, notes: 'Runner1 12k, Runner2 6k'
            },
            {
                id: '20250907', date: '2025-09-07', year: '2025', raceName: 'Corrida da Independ√™ncia - Uch√¥a', distance: 5,
                runner1: { status: 'planned' },
                runner2: { status: 'planned' },
                juntos: false, notes: ""
            },
            {
                id: '20250914', date: '2025-09-14', year: '2025', raceName: '6¬™ Corrida 17¬∞ BPM/I RP', distance: null,
                runner1: { status: 'completed', time: '01:29:55', distance: 17 },
                runner2: { status: 'planned', distance: 5 },
                juntos: false, notes: 'Runner1 17k, Runner2 5k (planejado)'
            },
            {
                id: '20251019', date: '2025-10-19', year: '2025', raceName: 'Corrida Sin Comerci√°rios', distance: 5,
                runner1: { status: 'completed', time: '00:25:00' },
                runner2: { status: 'planned' },
                juntos: false, notes: 'Meta Runner1: 25:00 ‚úÖ'
            },
            {
                id: '20251130', date: '2025-11-30', year: '2025', raceName: 'Corrida Instituto Unimed - Rio Preto', distance: null,
                runner1: { status: 'planned', distance: 16 },
                runner2: { status: 'planned', distance: 5 },
                juntos: false, notes: 'Runner1 16k, Runner2 5k'
            }
        ];
        
        // Fun√ß√µes Utilit√°rias... (sem altera√ß√µes)
        function timeToSeconds(timeStr) { if (!timeStr || typeof timeStr !== 'string') return null; const parts = timeStr.split(':').map(Number).filter(n => !isNaN(n)); let seconds = 0; if (parts.length === 2) { seconds = parts[0] * 60 + parts[1]; } else if (parts.length === 3) { seconds = parts[0] * 3600 + parts[1] * 60 + parts[2]; } else { return null; } return seconds; }
        function secondsToTime(totalSeconds) { if (totalSeconds === null || isNaN(totalSeconds) || totalSeconds === Infinity) return 'N/A'; totalSeconds = Math.round(totalSeconds); const hours = Math.floor(totalSeconds / 3600); const minutes = Math.floor((totalSeconds % 3600) / 60); const seconds = totalSeconds % 60; const pad = (num) => String(num).padStart(2, '0'); if (hours > 0) { return `${pad(hours)}:${pad(minutes)}:${pad(seconds)}`; } else { return `${pad(minutes)}:${pad(seconds)}`; } }
        function normalizeTime(timeStr) { if (!timeStr) return null; const cleanTime = timeStr.replace(/[^0-9:]/g, ''); const parts = cleanTime.split(':'); if (parts.length === 2) { return `00:${String(parts[0]).padStart(2, '0')}:${String(parts[1]).padStart(2, '0')}`; } else if (parts.length === 3) { return `${String(parts[0]).padStart(2, '0')}:${String(parts[1]).padStart(2, '0')}:${String(parts[2]).padStart(2, '0')}`; } return null; }
        function calculatePace(timeStr, distance) { const seconds = timeToSeconds(timeStr); const dist = parseFloat(distance); if (!seconds || !dist || dist <= 0) return 'N/A'; const paceInSeconds = seconds / dist; const paceMinutes = Math.floor(paceInSeconds / 60); const paceSeconds = Math.round(paceInSeconds % 60); return `${String(paceMinutes).padStart(2, '0')}:${String(paceSeconds).padStart(2, '0')} /km`; }

        // =================================================================
        // L√ìGICA DE AUTENTICA√á√ÉO E DADOS (FIREBASE)
        // =================================================================
        
        function setupUIForAuthState(user) {
            // Limpa listeners antigos para evitar duplica√ß√£o de dados
            if (profileRef) profileRef.off();
            if (racesRef) racesRef.off();
            if (pendingUsersRef) pendingUsersRef.off();

            const btnAdd = document.getElementById('btn-add-new');
            const adminPanel = document.getElementById('admin-panel');
            const publicSelector = document.getElementById('public-profile-selector');
            const loginForm = document.getElementById('login-form');
            const userInfo = document.getElementById('user-info');
            
            adminPanel.style.display = 'none'; // Esconde painel admin por padr√£o

            if (user) {
                // --- USU√ÅRIO LOGADO ---
                currentUser = user;
                viewingUserID = user.uid;
                
                userInfo.style.display = 'flex';
                loginForm.style.display = 'none';
                publicSelector.style.display = 'none';
                document.getElementById('user-email').textContent = `${user.email}`;
                btnAdd.disabled = false;
                btnAdd.textContent = '‚ûï Adicionar Nova Corrida';

                if (user.uid === ADMIN_UID) {
                    adminPanel.style.display = 'block';
                    loadPendingUsers();
                }
                
                loadUserProfile(user.uid);
            } else {
                // --- USU√ÅRIO DESLOGADO (VISITANTE) ---
                currentUser = null;
                
                userInfo.style.display = 'none';
                loginForm.style.display = 'flex';
                publicSelector.style.display = 'block';
                btnAdd.disabled = true;
                btnAdd.textContent = 'Fa√ßa login para adicionar corridas';

                loadApprovedUsersAndSetInitialView();
            }
        }

        function loadApprovedUsersAndSetInitialView() {
            const approvedUsersRef = db.ref('approved_users');
            approvedUsersRef.once('value', (snapshot) => {
                const users = snapshot.val();
                const select = document.getElementById('profile-select');
                select.innerHTML = '<option value="">Selecione um perfil...</option>';
                if (users) {
                    Object.keys(users).forEach(uid => {
                        const option = document.createElement('option');
                        option.value = uid;
                        option.textContent = `${users[uid].runner1_name} & ${users[uid].runner2_name}`;
                        if (uid === PUBLIC_PROFILE_UID_TO_VIEW) {
                            option.selected = true;
                        }
                        select.appendChild(option);
                    });
                }
                viewingUserID = select.value || null;
                if (viewingUserID) {
                    loadUserProfile(viewingUserID);
                } else {
                    document.getElementById('history-container').innerHTML = `<div id="loading-state">Nenhum perfil p√∫blico dispon√≠vel.</div>`;
                }
            });
        }
        
        function loadUserProfile(uid) {
            profileRef = db.ref(`users/${uid}/profile`);
            racesRef = db.ref(`users/${uid}/races`);
            
            profileRef.on('value', (snapshot) => {
                const profileData = snapshot.val();
                if(profileData) {
                    currentProfile.runner1_name = profileData.runner1_name || 'Corredor 1';
                    currentProfile.runner1_nameShort = profileData.runner1_name ? profileData.runner1_name.split(' ')[0] : 'C1';
                    currentProfile.runner1_emoji = "üèÉ‚Äç‚ôÇÔ∏è";
                    currentProfile.runner2_name = profileData.runner2_name || 'Corredor 2';
                    currentProfile.runner2_nameShort = profileData.runner2_name ? profileData.runner2_name.split(' ')[0] : 'C2';
                    currentProfile.runner2_emoji = "üèÉ‚Äç‚ôÄÔ∏è";
                    currentProfile.team_name = profileData.team_name || 'Equipe';
                }
                updateHeaderAndFormNames();
                renderAll();
            });

            racesRef.on('value', (snapshot) => {
                const data = snapshot.val();
                localRaces = data ? Object.keys(data).map(key => ({ id: key, ...data[key] })).sort((a, b) => new Date(b.date) - new Date(a.date)) : [];
                renderAll();
            });
        }

        function loadPendingUsers() {
            pendingUsersRef = db.ref('pending_users');
            pendingUsersRef.on('value', snapshot => {
                const list = document.getElementById('pending-users-list');
                list.innerHTML = '';
                const users = snapshot.val();
                if (!users) {
                    list.innerHTML = '<p style="text-align: center; color: #aaa;">Nenhum cadastro pendente.</p>';
                    return;
                }
                Object.keys(users).forEach(uid => {
                    const user = users[uid];
                    const userDiv = document.createElement('div');
                    userDiv.className = 'pending-user';
                    userDiv.innerHTML = `
                        <span>${user.email} (${user.runner1_name} & ${user.runner2_name})</span>
                        <div>
                            <button class="btn btn-primary approve-btn" data-uid="${uid}">Aprovar</button>
                            <button class="btn btn-secondary reject-btn" data-uid="${uid}" style="background:#dc3545;">Rejeitar</button>
                        </div>
                    `;
                    list.appendChild(userDiv);
                });

                document.querySelectorAll('.approve-btn').forEach(btn => btn.addEventListener('click', (e) => approveUser(e.target.dataset.uid)));
                document.querySelectorAll('.reject-btn').forEach(btn => btn.addEventListener('click', (e) => rejectUser(e.target.dataset.uid)));
            });
        }
        
        // ... (resto do JS, incluindo renderDashboard, renderHistory, etc.)
        
        // =================================================================
        // L√ìGICA DE RENDERIZA√á√ÉO (UI) - SEM ALTERA√á√ïES SIGNIFICATIVAS
        // =================================================================
        
        function renderDashboard() {
            const prGrid = document.getElementById('pr-grid');
            const summaryGrid = document.getElementById('summary-grid');
            const prs = { runner1: {}, runner2: {} };
            const distances = [2, 5, 6, 7, 10, 12, 16, 17];
            let totalKmR1 = 0, totalKmR2 = 0, totalRacesJuntos = 0, completedRacesR1 = 0, completedRacesR2 = 0;
            
            distances.forEach(d => {
                prs.runner1[d] = { time: 'N/A', seconds: Infinity };
                prs.runner2[d] = { time: 'N/A', seconds: Infinity };
            });

            localRaces.forEach(race => {
                if (race.juntos && race.runner1 && race.runner1.status === 'completed' && race.runner2 && race.runner2.status === 'completed') {
                    totalRacesJuntos++;
                }

                if (race.runner1 && race.runner1.status === 'completed') {
                    completedRacesR1++;
                    const dist = race.runner1.distance || race.distance;
                    const timeSec = timeToSeconds(race.runner1.time);
                    if (dist) totalKmR1 += dist;
                    if (prs.runner1[dist] && timeSec < prs.runner1[dist].seconds) {
                        prs.runner1[dist] = { seconds: timeSec, time: secondsToTime(timeSec) };
                    }
                }
                
                if (race.runner2 && race.runner2.status === 'completed') {
                    completedRacesR2++;
                    const dist = race.runner2.distance || race.distance;
                    const timeSec = timeToSeconds(race.runner2.time);
                    if (dist) totalKmR2 += dist;
                    if (prs.runner2[dist] && timeSec < prs.runner2[dist].seconds) {
                        prs.runner2[dist] = { seconds: timeSec, time: secondsToTime(timeSec) };
                    }
                }
            });
            
            prGrid.innerHTML = distances.map(d => `
                <div class="stat-card pr-card">
                    <div class="stat-label">PR ${d}km</div>
                    <div class="stat-number">
                        <div class="runner-pr"><span class="runner-pr-1">${currentProfile.runner1_nameShort}: ${prs.runner1[d].time}</span></div>
                        <div class="runner-pr"><strong class="runner-pr-2">${currentProfile.runner2_nameShort}: ${prs.runner2[d].time}</strong></div>
                    </div>
                </div>
            `).join('');

            summaryGrid.innerHTML = `
                <div class="stat-card">
                    <div class="stat-number">${completedRacesR1 + completedRacesR2}</div>
                    <div class="stat-label">Corridas Conclu√≠das (Total)</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">${totalRacesJuntos} üë©üèª‚Äç‚ù§Ô∏è‚Äçüë®üèª</div>
                    <div class="stat-label">Corridas Juntos</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">${(totalKmR1 + totalKmR2).toFixed(1)} km</div>
                    <div class="stat-label">Total KM (Casal)</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">
                        <span class="runner-pr-1">${totalKmR1.toFixed(1)}</span> / 
                        <strong class="runner-pr-2">${totalKmR2.toFixed(1)}</strong>
                    </div>
                    <div class="stat-label">Total KM (${currentProfile.runner1_nameShort} / ${currentProfile.runner2_nameShort})</div>
                </div>
            `;
        }

        function renderHistory() {
            const container = document.getElementById('history-container');
            const loading = document.getElementById('loading-state');
            container.innerHTML = '';
            
            if (localRaces.length === 0 && viewingUserID) {
                loading.textContent = "Nenhuma corrida encontrada para este perfil.";
                container.appendChild(loading);
                loading.classList.remove('hidden');
                return;
            } else if (!viewingUserID) {
                 loading.textContent = "Selecione um perfil para visualizar.";
                 container.appendChild(loading);
                 loading.classList.remove('hidden');
                 return;
            }
            
            loading.classList.add('hidden');
            
            const racesByYear = localRaces.reduce((acc, race) => {
                const year = race.year;
                if (!acc[year]) acc[year] = [];
                acc[year].push(race);
                return acc;
            }, {});

            const sortedYears = Object.keys(racesByYear).sort((a, b) => b - a);

            sortedYears.forEach(year => {
                const yearGroup = document.createElement('div');
                yearGroup.className = 'year-group';
                const yearEmoji = `2Ô∏è‚É£0Ô∏è‚É£${year.slice(2)}`;
                yearGroup.innerHTML = `<h2 class="year-title">${yearEmoji} (${racesByYear[year].length} provas)</h2>`;
                const raceList = document.createElement('div');
                raceList.className = 'race-card-list';
                racesByYear[year].forEach(race => raceList.appendChild(createRaceCard(race)));
                yearGroup.appendChild(raceList);
                container.appendChild(yearGroup);
            });
        }
        
        function createRaceCard(race) {
            const card = document.createElement('div');
            let cardStatus = 'completed';
            if ((race.runner1 && race.runner1.status === 'planned') || (race.runner2 && race.runner2.status === 'planned')) { cardStatus = 'planned'; }
            if ((race.runner1 && race.runner1.status === 'skipped') && (!race.runner2 || race.runner2.status === 'skipped')) { cardStatus = 'skipped'; }
            
            card.className = `race-card status-${cardStatus}`;
            card.dataset.id = race.id;

            const runner1Dist = (race.runner1 && race.runner1.distance) || race.distance;
            const runner2Dist = (race.runner2 && race.runner2.distance) || race.distance;
            const runner1Pace = (race.runner1 && race.runner1.status === 'completed') ? calculatePace(race.runner1.time, runner1Dist) : null;
            const runner2Pace = (race.runner2 && race.runner2.status === 'completed') ? calculatePace(race.runner2.time, runner2Dist) : null;

            let raceDistDisplay = race.distance ? `${race.distance}km` : (runner1Dist && runner2Dist && runner1Dist !== runner2Dist ? `${runner1Dist || '?'}k/${runner2Dist || '?'}k` : `${runner1Dist || runner2Dist || '?'}km`);

            const showControls = (currentUser && currentUser.uid === viewingUserID);

            card.innerHTML = `
                <div class="race-card-header"><h3>${race.raceName}</h3><span class="date">${new Date(race.date).toLocaleDateString('pt-BR', {timeZone: 'UTC', day: '2-digit', month: '2-digit', year: 'numeric'})}</span></div>
                <div class="race-card-body">
                    ${createRunnerInfoHTML(currentProfile.runner1_name, 'runner1', race.runner1, runner1Dist, runner1Pace, 'üèÉ‚Äç‚ôÇÔ∏è')}
                    ${createRunnerInfoHTML(currentProfile.runner2_name, 'runner2', race.runner2, runner2Dist, runner2Pace, 'üèÉ‚Äç‚ôÄÔ∏è')}
                </div>
                <div class="race-card-footer">
                    <div><span class="juntos-icon">${race.juntos ? 'üë©üèª‚Äç‚ù§Ô∏è‚Äçüë®üèª' : ''}</span><span class="race-notes">${race.notes || ''}</span></div>
                    <div style="display: flex; align-items: center;">
                        <span class="race-distance">${raceDistDisplay}</span>
                        <div class="race-controls ${showControls ? '' : 'hidden'}">
                            <button class="btn-control btn-edit" title="Editar">‚úèÔ∏è</button><button class="btn-control btn-delete" title="Excluir">üóëÔ∏è</button>
                        </div>
                    </div>
                </div>`;
            
            if (showControls) {
                card.querySelector('.btn-edit').addEventListener('click', () => openModal(race.id));
                card.querySelector('.btn-delete').addEventListener('click', () => deleteRace(race.id));
            }
            return card;
        }

        function createRunnerInfoHTML(name, runnerClass, runnerData, distance, pace, emoji) {
            let timeHTML = '', paceHTML = '';
            runnerData = runnerData || { status: 'skipped' };
            switch (runnerData.status) {
                case 'completed':
                    const time = secondsToTime(timeToSeconds(runnerData.time));
                    timeHTML = `<div class="runner-time">${time !== 'N/A' ? time : '‚úÖ'}</div>`;
                    if (pace && pace !== 'N/A') paceHTML = `<div class="runner-pace">${pace}</div>`;
                    break;
                case 'planned':
                    const goalTime = runnerData.goalTime || (runnerData.time && runnerData.time.includes(':') ? runnerData.time : null);
                    timeHTML = `<div class="runner-time goal">‚è≥ ${goalTime ? secondsToTime(timeToSeconds(goalTime)) : 'Planejada'}</div>`;
                    if (pace && pace !== 'N/A') paceHTML = `<div class="runner-pace goal">(Meta: ${pace})</div>`;
                    break;
                default: timeHTML = `<div class="runner-time skipped">‚ùå N√£o correu</div>`;
            }
            return `<div class="runner-info"><span class="runner-name ${runnerClass}">${name} ${emoji}</span><div class="runner-details">${timeHTML}${paceHTML}</div></div>`;
        }

        // --- Fun√ß√µes do Modal e L√≥gica de CRUD (Create, Read, Update, Delete) ---
        const modal = document.getElementById('race-modal'), form = document.getElementById('race-form'), modalTitle = document.getElementById('modal-title'), btnDelete = document.getElementById('btn-delete');
        
        function openModal(raceId = null) {
            if (!currentUser) return;
            form.reset();
            document.getElementById('race-id').value = '';
            btnDelete.classList.add('hidden');
            document.getElementById('runner1-form-name').innerHTML = `${currentProfile.runner1_name} ${currentProfile.runner1_emoji}`;
            document.getElementById('runner2-form-name').innerHTML = `${currentProfile.runner2_name} ${currentProfile.runner2_emoji}`;

            if (raceId) {
                modalTitle.textContent = 'Editar Corrida';
                btnDelete.classList.remove('hidden');
                const race = localRaces.find(r => r.id === raceId);
                if (!race) return;
                document.getElementById('race-id').value = race.id;
                document.getElementById('raceName').value = race.raceName;
                document.getElementById('raceDate').value = race.date;
                document.getElementById('raceDistance').value = race.distance;
                document.getElementById('raceJuntos').checked = race.juntos;
                document.getElementById('raceNotes').value = race.notes || '';
                
                if (race.runner1) {
                    document.getElementById('runner1Status').value = race.runner1.status || 'skipped';
                    const runner1Time = race.runner1.status === 'completed' ? race.runner1.time : (race.runner1.goalTime || race.runner1.time || '');
                    document.getElementById('runner1Time').value = normalizeTime(runner1Time) ? secondsToTime(timeToSeconds(runner1Time)) : '';
                    document.getElementById('runner1Distance').value = race.runner1.distance || '';
                }
                if (race.runner2) {
                    document.getElementById('runner2Status').value = race.runner2.status || 'skipped';
                    const runner2Time = race.runner2.status === 'completed' ? race.runner2.time : (race.runner2.goalTime || race.runner2.time || '');
                    document.getElementById('runner2Time').value = normalizeTime(runner2Time) ? secondsToTime(timeToSeconds(runner2Time)) : '';
                    document.getElementById('runner2Distance').value = race.runner2.distance || '';
                }
            } else {
                modalTitle.textContent = 'Adicionar Nova Corrida';
                document.getElementById('raceDate').value = new Date().toISOString().split('T')[0];
            }
            modal.showModal();
        }

        function closeModal() { modal.close(); }

        function handleFormSubmit(e) {
            e.preventDefault();
            if (!currentUser) { alert("Voc√™ precisa estar logado para salvar."); return; }

            const id = document.getElementById('race-id').value;
            const raceId = id || db.ref().push().key;
            
            const newRace = {
                date: document.getElementById('raceDate').value,
                year: new Date(document.getElementById('raceDate').value + 'T00:00:00').getFullYear().toString(),
                raceName: document.getElementById('raceName').value,
                distance: parseFloat(document.getElementById('raceDistance').value) || null,
                juntos: document.getElementById('raceJuntos').checked,
                notes: document.getElementById('raceNotes').value || null,
                runner1: {
                    status: document.getElementById('runner1Status').value,
                    time: document.getElementById('runner1Status').value === 'completed' ? normalizeTime(document.getElementById('runner1Time').value) : null,
                    goalTime: document.getElementById('runner1Status').value === 'planned' ? normalizeTime(document.getElementById('runner1Time').value) : null,
                    distance: parseFloat(document.getElementById('runner1Distance').value) || null
                },
                runner2: {
                    status: document.getElementById('runner2Status').value,
                    time: document.getElementById('runner2Status').value === 'completed' ? normalizeTime(document.getElementById('runner2Time').value) : null,
                    goalTime: document.getElementById('runner2Status').value === 'planned' ? normalizeTime(document.getElementById('runner2Time').value) : null,
                    distance: parseFloat(document.getElementById('runner2Distance').value) || null
                }
            };

            db.ref(`users/${currentUser.uid}/races/${raceId}`).set(newRace)
                .then(() => { closeModal(); })
                .catch(error => alert("Erro ao salvar: " + error.message));
        }

        function deleteRace(raceId) {
            if (!currentUser) return;
            const race = localRaces.find(r => r.id === raceId);
            if (!confirm(`Tem certeza que deseja excluir a corrida:\n\n${race.raceName}?`)) return;
            db.ref(`users/${currentUser.uid}/races/${raceId}`).remove()
                .then(() => closeModal())
                .catch(error => alert("Erro ao excluir: " + error.message));
        }

        function renderAll() {
            if(viewingUserID) {
                renderDashboard();
                renderHistory();
            }
        }
        
        // --- Fun√ß√µes de Administrador ---
        function approveUser(uid) {
            const pendingUserRef = db.ref(`pending_users/${uid}`);
            pendingUserRef.once('value', snapshot => {
                const userData = snapshot.val();
                if (!userData) return;

                // 1. Criar perfil p√∫blico
                db.ref(`approved_users/${uid}`).set({
                    runner1_name: userData.runner1_name,
                    runner2_name: userData.runner2_name,
                    email: userData.email
                });

                // 2. Criar perfil completo do usu√°rio
                db.ref(`users/${uid}/profile`).set({
                    runner1_name: userData.runner1_name,
                    runner2_name: userData.runner2_name,
                    email: userData.email,
                    team_name: "Nova Equipe"
                });

                // 3. Popular com dados iniciais
                const racesAsObject = initialRaceData.reduce((acc, race) => {
                    const newKey = db.ref().push().key; 
                    const raceData = { ...race };
                    delete raceData.id; // Remove o ID est√°tico
                    acc[newKey] = raceData;
                    return acc;
                }, {});
                db.ref(`users/${uid}/races`).set(racesAsObject);

                // 4. Remover da lista de pendentes
                pendingUserRef.remove();
            });
        }

        function rejectUser(uid) {
            if (!confirm("Isso excluir√° o pedido de cadastro. Deseja continuar?")) return;
            db.ref(`pending_users/${uid}`).remove();
            // Idealmente, aqui tamb√©m chamar√≠amos uma fun√ß√£o de backend para excluir o usu√°rio do Firebase Auth.
            // Por seguran√ßa, a exclus√£o de usu√°rios n√£o √© permitida diretamente do cliente.
            alert("Pedido de cadastro rejeitado. O usu√°rio ainda precisa ser removido manualmente do painel de Autentica√ß√£o do Firebase.");
        }


        // --- Inicializa√ß√£o e Event Listeners Globais ---
        
        document.addEventListener('DOMContentLoaded', () => {
            auth.onAuthStateChanged(setupUIForAuthState);
            
            document.getElementById('btn-add-new').addEventListener('click', () => openModal());
            document.getElementById('btn-close-modal').addEventListener('click', (e) => { e.preventDefault(); closeModal(); });
            document.getElementById('btn-cancel').addEventListener('click', (e) => { e.preventDefault(); closeModal(); });
            form.addEventListener('submit', handleFormSubmit);
            btnDelete.addEventListener('click', () => { if (document.getElementById('race-id').value) { deleteRace(document.getElementById('race-id').value); }});
            
            document.getElementById('login-form').addEventListener('submit', (e) => {
                e.preventDefault();
                const email = document.getElementById('login-email').value;
                const pass = document.getElementById('login-pass').value;
                auth.signInWithEmailAndPassword(email, pass).catch(error => alert("Erro no login: " + error.message));
            });

            document.getElementById('btn-signup').addEventListener('click', () => {
                const email = document.getElementById('login-email').value;
                const pass = document.getElementById('login-pass').value;
                if (!email || !pass || pass.length < 6) { alert("Preencha e-mail e uma senha com no m√≠nimo 6 caracteres."); return; }

                // Pede os nomes no momento do cadastro
                const r1 = prompt("Nome do Corredor 1:", "Thiago");
                const r2 = prompt("Nome do Corredor 2:", "Thamis");
                if(!r1 || !r2) return; // Cancela se n√£o preencher

                auth.createUserWithEmailAndPassword(email, pass)
                    .then(userCredential => {
                        db.ref(`pending_users/${userCredential.user.uid}`).set({
                            email: email,
                            runner1_name: r1,
                            runner2_name: r2,
                            requestedAt: firebase.database.ServerValue.TIMESTAMP
                        });
                        alert("Cadastro enviado! Aguarde a aprova√ß√£o do administrador para fazer login.");
                        auth.signOut(); // Desloga o usu√°rio at√© ser aprovado
                    })
                    .catch(error => alert("Erro ao cadastrar: " + error.message));
            });

            document.getElementById('btn-logout').addEventListener('click', () => auth.signOut());

            document.getElementById('profile-select').addEventListener('change', (e) => {
                const selectedUid = e.target.value;
                if (selectedUid) {
                    viewingUserID = selectedUid;
                    loadUserProfile(selectedUid);
                }
            });
        });
    </script>
</body>
</html>
